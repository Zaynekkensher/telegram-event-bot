import shlex

@dp.message(Command("добавить"))
async def quick_add_event(message: Message):
    try:
        parts = shlex.split(message.text)
        if len(parts) < 7:
            raise ValueError
        _, date_str, time_str, *rest = parts
        city, ev_type, place, description = rest
    except ValueError:
        return await message.answer(
        "❗️Неверный формат.\nПожалуйста, используйте шаблон:\n\n"
        '/добавить дд.мм.гггг чч:мм "Город с пробелами" "Тип события" "Место с пробелами" "Описание с пробелами"'
        )

    if not is_valid_date(date_str):
        return await message.answer("❗ Неверная дата. Используй формат: дд.мм.гггг")
    if not is_valid_time(time_str):
        return await message.answer("❗ Неверное время. Используй формат: чч:мм")

    chat_id = str(message.chat.id)
    data = load_data()
    if chat_id not in data:
        data[chat_id] = []
    data[chat_id].append({
        "date": date_str,
        "time": time_str,
        "city": city,
        "type": ev_type,
        "place": place,
        "description": description
    })
    save_data(data)

    await message.answer("✅ Событие добавлено!")